# apps/web/Dockerfile.dev
FROM node:20-bullseye

WORKDIR /workspace

# Deterministic pnpm
RUN corepack enable && corepack prepare pnpm@9.15.9 --activate

# Copy only manifests first for better layer caching
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml .npmrc ./

# Install workspace deps INSIDE the image (builds Linux-native binaries)
RUN pnpm install

# Now bring in the rest of the monorepo
COPY . .

ENV CHOKIDAR_USEPOLLING=true
EXPOSE 3000

# We let docker-compose set the command to run dev server
